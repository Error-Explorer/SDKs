var ErrorExplorer=function(){"use strict";const e={environment:"production",release:"",autoCapture:{errors:!0,unhandledRejections:!0,console:!0},breadcrumbs:{enabled:!0,maxBreadcrumbs:20,clicks:!0,navigation:!0,fetch:!0,xhr:!0,console:!0,inputs:!1},denyUrls:[],allowUrls:[],ignoreErrors:[],maxRetries:3,timeout:5e3,offline:!0,debug:!1};function t(t){let n,r;if(t.dsn){const e=function(e){try{const t=new URL(e),n=t.username;return n?(t.username="",{token:n,endpoint:t.toString()}):null}catch{return null}}(t.dsn);if(!e)throw new Error("[ErrorExplorer] Invalid DSN format");n=e.token,r=e.endpoint}else{if(!t.token)throw new Error("[ErrorExplorer] Either token or dsn is required");n=t.token,r=function(e,t){if(t.includes("{token}"))return t.replace("{token}",e);const n=t.endsWith("/")?"":"/";return`${t}${n}${e}`}(n,t.endpoint??"https://app.error-explorer.com/api/v1/webhook")}return n.startsWith("ee_")||console.warn('[ErrorExplorer] Token should start with "ee_"'),{token:n,endpoint:r,environment:t.environment??e.environment,release:t.release??e.release,autoCapture:{...e.autoCapture,...t.autoCapture},breadcrumbs:{...e.breadcrumbs,...t.breadcrumbs},beforeSend:t.beforeSend,denyUrls:t.denyUrls??e.denyUrls,allowUrls:t.allowUrls??e.allowUrls,ignoreErrors:t.ignoreErrors??e.ignoreErrors,maxRetries:t.maxRetries??e.maxRetries,timeout:t.timeout??e.timeout,offline:t.offline??e.offline,debug:t.debug??e.debug,hmacSecret:t.hmacSecret}}function n(e,t){return t.some(t=>"string"==typeof t?e.includes(t):t.test(e))}function r(e){const t=e.trim();if(!t||t.startsWith("Error:")||"Error"===t)return null;const n=t.match(/^\s*at\s+(?:(.+?)\s+\()?(?:(.+?):(\d+):(\d+)|(.+?):(\d+)|(.+?))\)?$/);if(n){const[,e,t,r,i,o,a,l]=n;return{function:e||"<anonymous>",filename:t||o||l,lineno:r?parseInt(r,10):a?parseInt(a,10):void 0,colno:i?parseInt(i,10):void 0,in_app:s(t||o||l)}}const r=t.match(/^(.+?)@(.+?):(\d+):(\d+)$/);if(r){const[,e,t,n,i]=r;return{function:e||"<anonymous>",filename:t,lineno:parseInt(n??"0",10),colno:parseInt(i??"0",10),in_app:s(t)}}const i=t.match(/^(?:(.+?)@)?(.+?):(\d+)(?::(\d+))?$/);if(i){const[,e,t,n,r]=i;return{function:e||"<anonymous>",filename:t,lineno:parseInt(n??"0",10),colno:r?parseInt(r,10):void 0,in_app:s(t)}}return t.length>0?{function:t,in_app:!1}:null}function s(e){if(!e)return!1;if(e.startsWith("<"))return!1;if("[native code]"===e||e.includes("native code"))return!1;if(e.includes("node_modules"))return!1;const t=[/cdn\./i,/unpkg\.com/i,/jsdelivr\.net/i,/cdnjs\.cloudflare\.com/i,/googleapis\.com/i,/gstatic\.com/i];for(const n of t)if(n.test(e))return!1;return!0}function i(e){if(e instanceof Error)return e.name||"Error";if("object"==typeof e&&null!==e){const t=e;if("string"==typeof t.name)return t.name}return"Error"}function o(e){if(e instanceof Error)return e.message;if("string"==typeof e)return e;if("object"==typeof e&&null!==e){const t=e;if("string"==typeof t.message)return t.message}try{return String(e)}catch{return"Unknown error"}}function a(e){if(e instanceof Error)return e.stack;if("object"==typeof e&&null!==e){const t=e;if("string"==typeof t.stack)return t.stack}}function l(){return"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}class c{constructor(e){this.breadcrumbs=[],this.maxBreadcrumbs=e.breadcrumbs.maxBreadcrumbs}add(e){const t={...e,timestamp:e.timestamp??Date.now()};for(this.breadcrumbs.push(t);this.breadcrumbs.length>this.maxBreadcrumbs;)this.breadcrumbs.shift()}getAll(){return[...this.breadcrumbs]}clear(){this.breadcrumbs=[]}get count(){return this.breadcrumbs.length}}let u=null;function h(){return u}const d=100;function f(e,t=0){if(null==e)return e;if("boolean"==typeof e||"number"==typeof e)return e;if("string"==typeof e)return p(e,1e3);if("bigint"==typeof e)return e.toString();if("symbol"==typeof e)return e.toString();if("function"==typeof e)return`[Function: ${e.name||"anonymous"}]`;if(t>=10)return"[Max depth reached]";if(e instanceof Error)return{name:e.name,message:e.message,stack:e.stack};if(e instanceof Date)return e.toISOString();if(e instanceof RegExp)return e.toString();if(Array.isArray(e)){const n=e.slice(0,d).map(e=>f(e,t+1));return e.length>d&&n.push(`[... ${e.length-d} more items]`),n}if("undefined"!=typeof Element&&e instanceof Element)return g(e);if("object"==typeof e){const n={},r=Object.keys(e),s=r.slice(0,d);for(const r of s)try{n[r]=f(e[r],t+1)}catch{n[r]="[Unserializable]"}return r.length>d&&(n["..."]=r.length-d+" more keys"),n}return"[Unknown type]"}function p(e,t){return e.length<=t?e:e.substring(0,t)+"..."}function g(e){const t=e.tagName.toLowerCase(),n=e.id?`#${e.id}`:"",r=e.className?`.${e.className.split(" ").filter(Boolean).join(".")}`:"";let s="";return e.textContent&&(s=p(e.textContent.trim(),50),s&&(s=` "${s}"`)),`<${t}${n}${r}${s}>`}function m(e){const t=[];let n=e,r=0;for(;n&&r<5;){let e=n.tagName.toLowerCase();if(n.id){e+=`#${n.id}`,t.unshift(e);break}if(n.className){const t=n.className.split(" ").filter(Boolean).slice(0,2);t.length>0&&(e+=`.${t.join(".")}`)}t.unshift(e),n=n.parentElement,r++}return t.join(" > ")}class w{constructor(){this.enabled=!1,this.handler=null}start(){this.enabled||"undefined"==typeof document||(this.handler=e=>{this.handleClick(e)},document.addEventListener("click",this.handler,{capture:!0,passive:!0}),this.enabled=!0)}stop(){this.enabled&&this.handler&&(document.removeEventListener("click",this.handler,{capture:!0}),this.handler=null,this.enabled=!1)}handleClick(e){const t=e.target;if(!(t instanceof Element))return;const n=h();if(!n)return;const r={type:"click",category:"ui",level:"info",data:{element:g(t),selector:m(t)}};if(t instanceof HTMLButtonElement||t instanceof HTMLAnchorElement){const e=t.textContent?.trim();e&&(r.message=`Clicked: "${p(e,50)}"`)}t instanceof HTMLAnchorElement&&t.href&&(r.data={...r.data,href:t.href}),n.add(r)}}let b=null;class y{constructor(){this.enabled=!1,this.lastUrl="",this.popstateHandler=null,this.hashchangeHandler=null,this.originalPushState=null,this.originalReplaceState=null}start(){this.enabled||"undefined"==typeof window||(this.lastUrl=window.location.href,this.popstateHandler=()=>{this.recordNavigation("popstate")},window.addEventListener("popstate",this.popstateHandler),this.hashchangeHandler=()=>{this.recordNavigation("hashchange")},window.addEventListener("hashchange",this.hashchangeHandler),this.originalPushState=history.pushState.bind(history),history.pushState=(...e)=>{this.originalPushState(...e),this.recordNavigation("pushState")},this.originalReplaceState=history.replaceState.bind(history),history.replaceState=(...e)=>{this.originalReplaceState(...e),this.recordNavigation("replaceState")},this.enabled=!0)}stop(){this.enabled&&(this.popstateHandler&&(window.removeEventListener("popstate",this.popstateHandler),this.popstateHandler=null),this.hashchangeHandler&&(window.removeEventListener("hashchange",this.hashchangeHandler),this.hashchangeHandler=null),this.originalPushState&&(history.pushState=this.originalPushState,this.originalPushState=null),this.originalReplaceState&&(history.replaceState=this.originalReplaceState,this.originalReplaceState=null),this.enabled=!1)}recordNavigation(e){const t=h();if(!t)return;const n=window.location.href,r=this.lastUrl,s=n;if(r===s)return;this.lastUrl=n;const i={type:"navigation",category:"navigation",level:"info",message:`Navigated to ${E(s)}`,data:{from:v(r),to:v(s),type:e}};t.add(i)}}function E(e){try{return new URL(e).pathname}catch{return e}}function v(e){try{const t=new URL(e);return t.pathname+t.search+t.hash}catch{return e}}let S=null;class x{constructor(){this.enabled=!1,this.originalFetch=null}start(){this.enabled||"undefined"==typeof window||"undefined"==typeof fetch||(this.originalFetch=window.fetch.bind(window),window.fetch=async(e,t)=>{const n=Date.now(),{method:r,url:s}=this.extractRequestInfo(e,t);let i,o=null;try{i=await this.originalFetch(e,t)}catch(e){throw o=e instanceof Error?e:new Error(String(e)),this.recordBreadcrumb(r,s,n,void 0,o),e}return this.recordBreadcrumb(r,s,n,i.status),i},this.enabled=!0)}stop(){this.enabled&&this.originalFetch&&(window.fetch=this.originalFetch,this.originalFetch=null,this.enabled=!1)}extractRequestInfo(e,t){let n,r="GET";return"string"==typeof e?n=e:e instanceof URL?n=e.toString():e instanceof Request?(n=e.url,r=e.method):n=String(e),t?.method&&(r=t.method),{method:r.toUpperCase(),url:n}}recordBreadcrumb(e,t,n,r,s){const i=h();if(!i)return;const o=Date.now()-n,a=function(e){try{const t=new URL(e,window.location.origin);return{full:t.href,pathname:t.pathname}}catch{return{full:e,pathname:e}}}(t),l={type:"fetch",category:"http",level:s||r&&r>=400?"error":"info",message:`${e} ${a.pathname}`,data:{method:e,url:a.full,status_code:r,duration_ms:o}};s&&(l.data={...l.data,error:s.message}),i.add(l)}}let k=null;class H{constructor(){this.enabled=!1,this.originalOpen=null,this.originalSend=null,this.xhrInfoMap=new WeakMap}start(){if(this.enabled||"undefined"==typeof XMLHttpRequest)return;const e=this;this.originalOpen=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(t,n,r=!0,s,i){return e.xhrInfoMap.set(this,{method:t.toUpperCase(),url:n.toString(),startTime:0}),e.originalOpen.call(this,t,n,r,s,i)},this.originalSend=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.send=function(t){const n=e.xhrInfoMap.get(this);return n&&(n.startTime=Date.now()),this.addEventListener("loadend",()=>{e.recordBreadcrumb(this)}),e.originalSend.call(this,t)},this.enabled=!0}stop(){this.enabled&&(this.originalOpen&&(XMLHttpRequest.prototype.open=this.originalOpen,this.originalOpen=null),this.originalSend&&(XMLHttpRequest.prototype.send=this.originalSend,this.originalSend=null),this.enabled=!1)}recordBreadcrumb(e){const t=h();if(!t)return;const n=this.xhrInfoMap.get(e);if(!n)return;const r=n.startTime>0?Date.now()-n.startTime:0,s=function(e){try{const t=new URL(e,window.location.origin);return{full:t.href,pathname:t.pathname}}catch{return{full:e,pathname:e}}}(n.url),i=e.status,o={type:"xhr",category:"http",level:0===i||i>=400?"error":"info",message:`${n.method} ${s.pathname}`,data:{method:n.method,url:s.full,status_code:i||void 0,duration_ms:r}};0===i&&(o.data={...o.data,error:"Request failed (network error or CORS)"}),t.add(o)}}let C=null;const _={log:"info",info:"info",warn:"warning",error:"error",debug:"debug"};class L{constructor(){this.enabled=!1,this.originalMethods={}}start(){if(this.enabled||"undefined"==typeof console)return;const e=["log","info","warn","error","debug"];for(const t of e)this.wrapConsoleMethod(t);this.enabled=!0}stop(){if(this.enabled){for(const[e,t]of Object.entries(this.originalMethods))t&&(console[e]=t);this.originalMethods={},this.enabled=!1}}wrapConsoleMethod(e){const t=console[e];t&&(this.originalMethods[e]=t,console[e]=(...n)=>{t.apply(console,n),this.recordBreadcrumb(e,n)})}recordBreadcrumb(e,t){const n=h();if(!n)return;const r=this.formatMessage(t),s={type:"console",category:"console",level:_[e],message:p(r,200),data:{level:e,arguments:t.length>1?t.map(e=>f(e)):void 0}};n.add(s)}formatMessage(e){return 0===e.length?"":e.map(e=>{if("string"==typeof e)return e;if(e instanceof Error)return`${e.name}: ${e.message}`;try{return JSON.stringify(e)}catch{return String(e)}}).join(" ")}}let M=null;class R{constructor(){this.enabled=!1,this.focusHandler=null,this.blurHandler=null}start(){this.enabled||"undefined"==typeof document||(this.focusHandler=e=>{this.handleFocus(e)},this.blurHandler=e=>{this.handleBlur(e)},document.addEventListener("focus",this.focusHandler,{capture:!0,passive:!0}),document.addEventListener("blur",this.blurHandler,{capture:!0,passive:!0}),this.enabled=!0)}stop(){this.enabled&&(this.focusHandler&&(document.removeEventListener("focus",this.focusHandler,{capture:!0}),this.focusHandler=null),this.blurHandler&&(document.removeEventListener("blur",this.blurHandler,{capture:!0}),this.blurHandler=null),this.enabled=!1)}handleFocus(e){const t=e.target;this.isTrackedElement(t)&&this.recordBreadcrumb(t,"focus")}handleBlur(e){const t=e.target;this.isTrackedElement(t)&&this.recordBreadcrumb(t,"blur")}isTrackedElement(e){return!!e&&(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)}recordBreadcrumb(e,t){const n=h();if(!n)return;const r=e instanceof HTMLInputElement?e.type:e.tagName.toLowerCase(),s=e.name||e.id||void 0,i={type:"input",category:"ui",level:"info",message:`Input ${t}: ${r}${s?` (${s})`:""}`,data:{action:t,element_type:r,name:s,selector:m(e)}};n.add(i)}}let j=null;class U{constructor(){this.enabled=!1,this.handler=null,this.originalOnError=null}start(e){this.enabled||"undefined"==typeof window||(this.handler=e,this.originalOnError=window.onerror,window.onerror=(e,t,n,r,s)=>(this.originalOnError&&this.originalOnError.call(window,e,t,n,r,s),this.handleError(e,t,n,r,s),!1),this.enabled=!0)}stop(){this.enabled&&(window.onerror=this.originalOnError,this.originalOnError=null,this.handler=null,this.enabled=!1)}handleError(e,t,n,r,s){if(!this.handler)return;const o={message:this.extractMessage(e,s),name:s?i(s):"Error",stack:s?a(s):void 0,filename:t,lineno:n,colno:r,severity:"error",originalError:s};this.handler(o)}extractMessage(e,t){return t?o(t):"string"==typeof e?e:e instanceof ErrorEvent&&e.message||"Unknown error"}}let O=null;class T{constructor(){this.enabled=!1,this.handler=null,this.rejectionHandler=null}start(e){this.enabled||"undefined"==typeof window||(this.handler=e,this.rejectionHandler=e=>{this.handleRejection(e)},window.addEventListener("unhandledrejection",this.rejectionHandler),this.enabled=!0)}stop(){this.enabled&&this.rejectionHandler&&(window.removeEventListener("unhandledrejection",this.rejectionHandler),this.rejectionHandler=null,this.handler=null,this.enabled=!1)}handleRejection(e){if(!this.handler)return;const t=e.reason,n={message:this.extractMessage(t),name:this.extractName(t),stack:this.extractStack(t),severity:"error",originalError:t instanceof Error?t:void 0};this.handler(n)}extractMessage(e){if(e instanceof Error)return o(e);if("string"==typeof e)return e;if(void 0===e)return"Promise rejected with undefined";if(null===e)return"Promise rejected with null";if("object"==typeof e&&null!==e){const t=e;if("string"==typeof t.message)return t.message}try{return`Promise rejected with: ${JSON.stringify(e)}`}catch{return"Promise rejected with non-serializable value"}}extractName(e){if(e instanceof Error)return i(e);if("object"==typeof e&&null!==e){const t=e;if("string"==typeof t.name)return t.name}return"UnhandledRejection"}extractStack(e){if(e instanceof Error)return a(e);if("object"==typeof e&&null!==e){const t=e;if("string"==typeof t.stack)return t.stack}}}let I=null;class q{constructor(){this.enabled=!1,this.handler=null,this.originalConsoleError=null}start(e){this.enabled||"undefined"==typeof console||(this.handler=e,this.originalConsoleError=console.error,console.error=(...e)=>{this.originalConsoleError.apply(console,e),this.handleConsoleError(e)},this.enabled=!0)}stop(){this.enabled&&this.originalConsoleError&&(console.error=this.originalConsoleError,this.originalConsoleError=null,this.handler=null,this.enabled=!1)}handleConsoleError(e){if(!this.handler||0===e.length)return;const t=e[0];let n;if(t instanceof Error)n={message:o(t),name:i(t),stack:a(t),severity:"error",originalError:t};else{n={message:e.map(e=>{if("string"==typeof e)return e;if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch{return String(e)}}).join(" "),name:"ConsoleError",severity:"error"};for(const t of e)if(t instanceof Error){n.stack=a(t),n.originalError=t;break}}this.handler(n)}}let A=null;function F(){if("undefined"==typeof window||"undefined"==typeof navigator)return{};const e={user_agent:navigator.userAgent,language:navigator.language,online:navigator.onLine},t=function(e){const t=[{name:"Edge",pattern:/Edg(?:e|A|iOS)?\/(\d+(?:\.\d+)*)/},{name:"Opera",pattern:/(?:OPR|Opera)\/(\d+(?:\.\d+)*)/},{name:"Chrome",pattern:/Chrome\/(\d+(?:\.\d+)*)/},{name:"Safari",pattern:/Version\/(\d+(?:\.\d+)*).*Safari/},{name:"Firefox",pattern:/Firefox\/(\d+(?:\.\d+)*)/},{name:"IE",pattern:/(?:MSIE |rv:)(\d+(?:\.\d+)*)/}];for(const n of t){const t=e.match(n.pattern);if(t?.[1])return{name:n.name,version:t[1]}}return null}(navigator.userAgent);if(t&&(e.name=t.name,e.version=t.version),e.viewport={width:window.innerWidth,height:window.innerHeight},"memory"in performance){const t=performance.memory;t&&(e.memory={used_js_heap_size:t.usedJSHeapSize,total_js_heap_size:t.totalJSHeapSize,js_heap_size_limit:t.jsHeapSizeLimit})}return e}const $="ee_session";class B{constructor(){this.session=null,this.loadOrCreateSession()}getContext(){return this.ensureActiveSession(),{id:this.session.id,started_at:this.session.started_at,page_views:this.session.page_views}}recordPageView(){this.ensureActiveSession(),this.session.page_views++,this.session.last_activity=Date.now(),this.saveSession()}getSessionId(){return this.ensureActiveSession(),this.session.id}loadOrCreateSession(){const e=this.loadSession();e&&this.isSessionValid(e)?(this.session=e,this.session.last_activity=Date.now(),this.session.page_views++,this.saveSession()):this.createNewSession()}ensureActiveSession(){this.session&&this.isSessionValid(this.session)||this.createNewSession()}createNewSession(){this.session={id:l().replace(/-/g,"").substring(0,16),started_at:(new Date).toISOString(),last_activity:Date.now(),page_views:1},this.saveSession()}isSessionValid(e){return Date.now()-e.last_activity<18e5}loadSession(){try{if("undefined"==typeof sessionStorage)return null;const e=sessionStorage.getItem($);return e?JSON.parse(e):null}catch{return null}}saveSession(){try{if("undefined"==typeof sessionStorage||!this.session)return;sessionStorage.setItem($,JSON.stringify(this.session))}catch{}}}let N=null;function z(){return N||(N=new B),N}class D{constructor(){this.user=null}setUser(e){this.user={...e}}getUser(){return this.user?{...this.user}:null}clearUser(){this.user=null}hasUser(){return null!==this.user}}let P=null;function Q(){return P||(P=new D),P}function J(){if("undefined"==typeof window)return{};const e=window.location;return{url:e.href,method:"GET",query_string:e.search?e.search.substring(1):void 0}}class V{constructor(e){this.secret=e,this.encoder=new TextEncoder}async sign(e,t){const n=`${t??Math.floor(Date.now()/1e3)}.${e}`,r=await this.getKey(),s=await crypto.subtle.sign("HMAC",r,this.encoder.encode(n));return this.arrayBufferToHex(s)}async buildHeaders(e){const t=Math.floor(Date.now()/1e3);return{"X-Webhook-Signature":await this.sign(e,t),"X-Webhook-Timestamp":String(t)}}async getKey(){return crypto.subtle.importKey("raw",this.encoder.encode(this.secret),{name:"HMAC",hash:"SHA-256"},!1,["sign"])}arrayBufferToHex(e){const t=new Uint8Array(e);return Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")}}class X{constructor(e){this.hmacSigner=null,this.endpoint=e.endpoint,this.token=e.token,this.timeout=e.timeout,e.hmacSecret&&(this.hmacSigner=new V(e.hmacSecret))}async send(e){try{const t=JSON.stringify(e);return!(this.hmacSigner||!this.trySendBeacon(t))||await this.sendFetch(t)}catch(e){return console.warn("[ErrorExplorer] Failed to send event:",e),!1}}trySendBeacon(e){if("undefined"==typeof navigator||!navigator.sendBeacon)return!1;try{const t=new Blob([e],{type:"application/json"});return navigator.sendBeacon(this.endpoint,t)}catch{return!1}}async sendFetch(e){const t=new AbortController,n=setTimeout(()=>t.abort(),this.timeout);try{const r={"Content-Type":"application/json","X-Webhook-Token":this.token};if(this.hmacSigner){const t=await this.hmacSigner.buildHeaders(e);Object.assign(r,t)}const s=await fetch(this.endpoint,{method:"POST",headers:r,body:e,signal:t.signal,keepalive:!0});return clearTimeout(n),s.ok}catch(e){return clearTimeout(n),e instanceof Error&&"AbortError"===e.name&&console.warn("[ErrorExplorer] Request timed out"),!1}}}class W{constructor(e=10,t=6e4){this.timestamps=[],this.maxRequests=e,this.windowMs=t}isAllowed(){const e=Date.now();return this.timestamps=this.timestamps.filter(t=>e-t<this.windowMs),!(this.timestamps.length>=this.maxRequests)&&(this.timestamps.push(e),!0)}getRemaining(){const e=Date.now();return this.timestamps=this.timestamps.filter(t=>e-t<this.windowMs),Math.max(0,this.maxRequests-this.timestamps.length)}reset(){this.timestamps=[]}}let K=null;class G{constructor(e=3){this.queue=[],this.processing=!1,this.sendFn=null,this.maxRetries=e}setSendFunction(e){this.sendFn=e}enqueue(e){this.queue.push({event:e,retries:0,timestamp:Date.now()}),this.processQueue()}async processQueue(){if(!this.processing&&this.sendFn&&0!==this.queue.length){for(this.processing=!0;this.queue.length>0;){const e=this.queue[0];if(!e)break;if(e.retries>=this.maxRetries){this.queue.shift();continue}const t=this.calculateDelay(e.retries);await this.sleep(t);await this.sendFn(e.event)?this.queue.shift():(e.retries++,e.retries>=this.maxRetries&&(this.queue.shift(),console.warn("[ErrorExplorer] Max retries reached, dropping event")))}this.processing=!1}}calculateDelay(e){return 1e3*Math.pow(2,e)+1e3*Math.random()}sleep(e){return new Promise(t=>setTimeout(t,e))}getQueueSize(){return this.queue.length}clear(){this.queue=[]}}let Z=null;function Y(){return Z||(Z=new G),Z}const ee="ee_offline_queue";class te{constructor(e=!0){this.sendFn=null,this.onlineHandler=null,this.enabled=e&&"undefined"!=typeof localStorage,this.enabled&&this.setupOnlineListener()}setSendFunction(e){this.sendFn=e}isOnline(){return"undefined"==typeof navigator||navigator.onLine}enqueue(e){if(this.enabled)try{const t=this.loadQueue();for(t.push(e);t.length>50;)t.shift();this.saveQueue(t)}catch(e){console.warn("[ErrorExplorer] Failed to save to offline queue:",e)}}async flush(){if(!this.enabled||!this.sendFn||!this.isOnline())return;const e=this.loadQueue();if(0===e.length)return;this.saveQueue([]);const t=[];for(const n of e)try{await this.sendFn(n)||t.push(n)}catch{t.push(n)}if(t.length>0){const e=this.loadQueue();this.saveQueue([...t,...e].slice(0,50))}}getQueueSize(){return this.loadQueue().length}clear(){this.saveQueue([])}destroy(){this.onlineHandler&&"undefined"!=typeof window&&(window.removeEventListener("online",this.onlineHandler),this.onlineHandler=null)}setupOnlineListener(){"undefined"!=typeof window&&(this.onlineHandler=()=>{this.flush()},window.addEventListener("online",this.onlineHandler))}loadQueue(){try{const e=localStorage.getItem(ee);return e?JSON.parse(e):[]}catch{return[]}}saveQueue(e){try{0===e.length?localStorage.removeItem(ee):localStorage.setItem(ee,JSON.stringify(e))}catch{}}}let ne=null;function re(e=!0){return ne||(ne=new te(e)),ne}const se=["password","passwd","secret","token","api_key","apikey","access_token","accesstoken","refresh_token","refreshtoken","auth","authorization","credit_card","creditcard","card_number","cardnumber","cvv","cvc","ssn","social_security","private_key","privatekey"],ie="[FILTERED]";class oe{constructor(e=[]){this.scrubFields=new Set([...se.map(e=>e.toLowerCase()),...e.map(e=>e.toLowerCase())])}scrub(e){return this.scrubValue(e,0)}scrubValue(e,t){if(t>10)return e;if(null==e)return e;if("object"!=typeof e)return e;if(Array.isArray(e))return e.map(e=>this.scrubValue(e,t+1));const n={};for(const[r,s]of Object.entries(e))this.shouldScrub(r)?n[r]=ie:n[r]="string"==typeof s?this.scrubString(s):this.scrubValue(s,t+1);return n}shouldScrub(e){const t=e.toLowerCase();return this.scrubFields.has(t)}scrubString(e){let t=e;return t=t.replace(/\b\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{1,7}\b/g,ie),t=t.replace(/\b(sk|pk|api|key|token|secret)_[a-zA-Z0-9]{20,}\b/gi,ie),t=t.replace(/Bearer\s+[a-zA-Z0-9._-]+/gi,`Bearer ${ie}`),t}addFields(e){for(const t of e)this.scrubFields.add(t.toLowerCase())}}let ae=null;const le=new class{constructor(){this.config=null,this.transport=null,this.initialized=!1,this.tags={},this.extra={},this.contexts={}}init(e){var n;if(this.initialized)console.warn("[ErrorExplorer] Already initialized");else try{this.config=t(e),this.transport=new X({endpoint:this.config.endpoint,token:this.config.token,timeout:this.config.timeout,maxRetries:this.config.maxRetries,hmacSecret:this.config.hmacSecret}),function(e=[]){ae=new oe(e)}();const r=this.sendEvent.bind(this);Y().setSendFunction(r),re(this.config.offline).setSendFunction(r),this.config.breadcrumbs.enabled&&(n=this.config,u=new c(n),this.startBreadcrumbTrackers()),this.config.autoCapture.errors&&(O||(O=new U),O).start(this.handleCapturedError.bind(this)),this.config.autoCapture.unhandledRejections&&(I||(I=new T),I).start(this.handleCapturedError.bind(this)),this.config.autoCapture.console&&(A||(A=new q),A).start(this.handleCapturedError.bind(this)),z().recordPageView(),re(this.config.offline).flush(),this.initialized=!0,this.config.debug&&console.log("[ErrorExplorer] Initialized",{endpoint:this.config.endpoint,environment:this.config.environment})}catch(e){console.error("[ErrorExplorer] Initialization failed:",e)}}isInitialized(){return this.initialized}setUser(e){Q().setUser(e)}clearUser(){Q().clearUser()}setTag(e,t){this.tags[e]=t}setTags(e){this.tags={...this.tags,...e}}setExtra(e){this.extra={...this.extra,...e}}setContext(e,t){this.contexts[e]=t}addBreadcrumb(e){const t=h();t&&t.add(e)}captureException(e,t){if(!this.initialized||!this.config)return console.warn("[ErrorExplorer] Not initialized"),"";const n=l(),r=this.buildEvent(e,t,"error");return this.processAndSend(r),n}captureMessage(e,t="info"){if(!this.initialized||!this.config)return console.warn("[ErrorExplorer] Not initialized"),"";const n=l(),r=this.buildEvent(new Error(e),void 0,t);return r.exception_class="Message",this.processAndSend(r),n}async flush(e=5e3){return!!this.initialized&&new Promise(t=>{const n=setTimeout(()=>t(!1),e);Promise.all([re().flush()]).then(()=>{clearTimeout(n),t(!0)}).catch(()=>{clearTimeout(n),t(!1)})})}async close(e=5e3){return!this.initialized||(await this.flush(e),this.stopAllTrackers(),u=null,O&&(O.stop(),O=null),I&&(I.stop(),I=null),A&&(A.stop(),A=null),N=null,P=null,K=null,Z&&Z.clear(),Z=null,ne&&ne.destroy(),ne=null,ae=null,this.config=null,this.transport=null,this.initialized=!1,this.tags={},this.extra={},this.contexts={},!0)}handleCapturedError(e){if(!this.config)return;if(this.shouldIgnoreError(e))return void(this.config.debug&&console.log("[ErrorExplorer] Ignoring error:",e.message));const t=this.buildEventFromCapture(e);this.processAndSend(t)}shouldIgnoreError(e){return!this.config||(!!n(e.message,this.config.ignoreErrors)||(!(!e.filename||!n(e.filename,this.config.denyUrls))||!(!(this.config.allowUrls.length>0&&e.filename)||n(e.filename,this.config.allowUrls))))}buildEventFromCapture(e){return this.buildEvent(e.originalError||new Error(e.message),void 0,e.severity)}buildEvent(e,t,n="error"){const s=this.config,l=o(e),c=i(e),u=a(e),d=function(e){if(!e)return[];const t=e.split("\n"),n=[];for(const e of t){const t=r(e);t&&n.push(t)}return n}(u),f=d[0];return{message:l,exception_class:c,file:f?.filename,line:f?.lineno,column:f?.colno,stack_trace:u,frames:d,severity:t?.level??n,environment:s.environment,release:s.release||void 0,timestamp:(new Date).toISOString(),user:t?.user??Q().getUser()??void 0,request:J(),browser:F(),session:z().getContext(),breadcrumbs:h()?.getAll(),tags:{...this.tags,...t?.tags},extra:{...this.extra,...t?.extra},contexts:this.contexts,sdk:{name:"@error-explorer/browser",version:"1.0.0"},fingerprint:t?.fingerprint}}processAndSend(e){if(!this.config)return;let t=e;if(this.config.beforeSend)try{t=this.config.beforeSend(e)}catch(n){console.error("[ErrorExplorer] beforeSend threw an error:",n),t=e}if(t)return(K||(K=new W),K).isAllowed()?void(re(this.config.offline).isOnline()?this.sendEvent(t):re(this.config.offline).enqueue(t)):(this.config.debug&&console.log("[ErrorExplorer] Rate limit exceeded, queuing event"),void Y().enqueue(t));this.config.debug&&console.log("[ErrorExplorer] Event dropped by beforeSend")}async sendEvent(e){if(!this.transport)return!1;const t=await this.transport.send(e);return!t&&this.config?.offline&&Y().enqueue(e),t}startBreadcrumbTrackers(){if(!this.config)return;const e=this.config.breadcrumbs;e.clicks&&(b||(b=new w),b).start(),e.navigation&&(S||(S=new y),S).start(),e.fetch&&(k||(k=new x),k).start(),e.xhr&&(C||(C=new H),C).start(),e.console&&(M||(M=new L),M).start(),e.inputs&&(j||(j=new R),j).start()}stopAllTrackers(){b&&(b.stop(),b=null),S&&(S.stop(),S=null),k&&(k.stop(),k=null),C&&(C.stop(),C=null),M&&(M.stop(),M=null),j&&(j.stop(),j=null)}};return"undefined"!=typeof window&&(window.ErrorExplorer=le),le}();
//# sourceMappingURL=error-explorer.min.js.map
